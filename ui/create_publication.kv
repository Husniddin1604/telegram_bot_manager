<CreatePublicationScreen>:
    name: "create_publication"

    canvas.before:
        Color:
            rgba: 0.98, 0.98, 0.98, 1
        Rectangle:
            pos: self.pos
            size: self.size

    BoxLayout:
        orientation: "vertical"

        # Верхняя панель с кнопкой "Назад" и заголовком
        BoxLayout:
            size_hint_y: None
            height: dp(60)
            padding: dp(10), dp(10)
            spacing: dp(10)
            canvas.before:
                Color:
                    rgba: 1, 1, 1, 1
                Rectangle:
                    pos: self.pos
                    size: self.size

            Button:
                text: "Назад"
                size_hint: None, None
                width: dp(80)
                height: dp(40)
                background_normal: ""
                background_color: 0, 0, 0, 0
                color: 1, 0.0, 0.0, 1
                font_size: "16sp"
                on_release: root.back_to_menu()

            Label:
                text: "Новая публикация"
                font_size: "18sp"
                color: 0.2, 0.2, 0.2, 1
                halign: "center"
                valign: "middle"


        # Основной контент со скроллом
        ScrollView:
            do_scroll_x: False

            BoxLayout:
                orientation: "vertical"
                padding: dp(20), dp(10)
                spacing: dp(15)
                size_hint_y: None
                height: self.minimum_height

                # Куда отправить сообщение
                Label:
                    text: "Куда отправить сообщение"
                    font_size: "14sp"
                    color: 0.4, 0.4, 0.4, 1
                    size_hint_y: None
                    height: dp(25)
                    halign: "left"
                    valign: "middle"
                    text_size: self.width, None

                # Спиннер выбора канала
                Spinner:
                    id: channel_spinner
                    text: "Выберите канал или группу"
                    values: ["Выберите канал или группу"]
                    size_hint_y: None
                    height: dp(45)
                    background_normal: ""
                    background_color: 1, 1, 1, 1
                    color: 0.3, 0.3, 0.3, 1
                    font_size: "15sp"
                    canvas.before:
                        Color:
                            rgba: 0.95, 0.95, 0.95, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(8)]

                # Текст публикации
                Label:
                    text: "Текст публикации"
                    font_size: "14sp"
                    color: 0.4, 0.4, 0.4, 1
                    size_hint_y: None
                    height: dp(25)
                    halign: "left"
                    valign: "middle"
                    text_size: self.width, None

                # Поле ввода текста
                TextInput:
                    id: publication_text
                    hint_text: "Введите текст публикации..."
                    multiline: True
                    size_hint_y: None
                    height: dp(120)
                    padding: dp(15), dp(15)
                    background_normal: ""
                    background_color: 1, 1, 1, 1
                    foreground_color: 0.2, 0.2, 0.2, 1
                    font_size: "15sp"
                    canvas.before:
                        Color:
                            rgba: 0.95, 0.95, 0.95, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(8)]

                # Кнопка "Добавить медиа"
                Button:
                    text: "Добавить медиа"
                    size_hint_y: None
                    height: dp(45)
                    background_normal: ""
                    background_color: 0, 0, 0, 0
                    color: 0.4, 0.4, 0.4, 1
                    font_size: "15sp"
                    on_release: root.add_media()
                    canvas.before:
                        Color:
                            rgba: 0.95, 0.95, 0.95, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(8)]


                # Разделитель
                Widget:
                    size_hint_y: None
                    height: dp(1)
                    canvas:
                        Color:
                            rgba: 0.9, 0.9, 0.9, 1
                        Rectangle:
                            pos: self.pos
                            size: self.size

                # Блок "Настройки отправки"
                BoxLayout:
                    orientation: "vertical"
                    size_hint_y: None
                    height: dp(220)
                    padding: dp(15)
                    spacing: dp(12)
                    canvas.before:
                        Color:
                            rgba: 1, 1, 1, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(12)]

                    Label:
                        text: "Настройки отправки"
                        font_size: "15sp"
                        bold: True
                        color: 0.2, 0.2, 0.2, 1
                        size_hint_y: None
                        height: dp(30)
                        halign: "left"
                        valign: "middle"
                        text_size: self.width, None

                    # Запланировать с переключателем
                    BoxLayout:
                        orientation: "horizontal"
                        size_hint_y: None
                        height: dp(40)

                        Label:
                            text: "Запланировать"
                            font_size: "14sp"
                            color: 0.3, 0.3, 0.3, 1
                            halign: "left"
                            valign: "middle"
                            text_size: self.width, None

                        Label:
                            text: "Выберите дату и время"
                            font_size: "13sp"
                            color: 0.6, 0.6, 0.6, 1
                            halign: "right"
                            valign: "middle"
                            size_hint_x: 0.6

                        # Переключатель (заглушка)
                        Widget:
                            size_hint: None, None
                            width: dp(50)
                            height: dp(30)
                            canvas:
                                Color:
                                    rgba: 0.8, 0.8, 0.8, 1
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(15)]
                                Color:
                                    rgba: 1, 1, 1, 1
                                Ellipse:
                                    pos: self.x + dp(3), self.y + dp(3)
                                    size: dp(24), dp(24)

                    # Дата и Время
                    BoxLayout:
                        orientation: "horizontal"
                        size_hint_y: None
                        height: dp(45)
                        spacing: dp(10)

                        # Дата
                        BoxLayout:
                            orientation: "vertical"

                            Label:
                                text: "Дата"
                                font_size: "13sp"
                                color: 0.4, 0.4, 0.4, 1
                                size_hint_y: None
                                height: dp(18)
                                halign: "left"
                                valign: "middle"
                                text_size: self.width, None

                            Label:
                                text: "mm/dd/yyyy"
                                font_size: "14sp"
                                color: 0.6, 0.6, 0.6, 1
                                halign: "left"
                                valign: "middle"
                                canvas.before:
                                    Color:
                                        rgba: 0.96, 0.96, 0.96, 1
                                    RoundedRectangle:
                                        pos: self.pos
                                        size: self.size
                                        radius: [dp(6)]

                        # Время
                        BoxLayout:
                            orientation: "vertical"

                            Label:
                                text: "Время"
                                font_size: "13sp"
                                color: 0.4, 0.4, 0.4, 1
                                size_hint_y: None
                                height: dp(18)
                                halign: "left"
                                valign: "middle"
                                text_size: self.width, None

                            Label:
                                text: "--:--"
                                font_size: "14sp"
                                color: 0.6, 0.6, 0.6, 1
                                halign: "left"
                                valign: "middle"
                                canvas.before:
                                    Color:
                                        rgba: 0.96, 0.96, 0.96, 1
                                    RoundedRectangle:
                                        pos: self.pos
                                        size: self.size
                                        radius: [dp(6)]

                    # Повторять
                    BoxLayout:
                        orientation: "vertical"
                        size_hint_y: None
                        height: dp(60)

                        Label:
                            text: "Повторять"
                            font_size: "13sp"
                            color: 0.4, 0.4, 0.4, 1
                            size_hint_y: None
                            height: dp(18)
                            halign: "left"
                            valign: "middle"
                            text_size: self.width, None

                        Button:
                            text: "Не повторять"
                            size_hint_y: None
                            height: dp(35)
                            background_normal: ""
                            background_color: 0, 0, 0, 0
                            color: 0.4, 0.4, 0.4, 1
                            font_size: "14sp"
                            halign: "left"
                            on_release: root.show_repeat_popup()
                            canvas.before:
                                Color:
                                    rgba: 0.96, 0.96, 0.96, 1
                                RoundedRectangle:
                                    pos: self.pos
                                    size: self.size
                                    radius: [dp(6)]

                # Отступ перед кнопками
                Widget:
                    size_hint_y: None
                    height: dp(10)

                # Кнопка "Отправить" (большая синяя)
                Button:
                    id: send_btn
                    text: "Отправить"
                    size_hint_y: None
                    height: dp(50)
                    background_normal: ""
                    background_color: 0, 0, 0, 0
                    color: 1, 1, 1, 1
                    font_size: "16sp"
                    bold: True
                    on_release: root.send_publication()
                    canvas.before:
                        Color:
                            rgba: 0.35, 0.45, 0.95, 1
                        RoundedRectangle:
                            pos: self.pos
                            size: self.size
                            radius: [dp(10)]

                # Кнопки "Сохранить как шаблон" и "Назад"
                BoxLayout:
                    orientation: "horizontal"
                    size_hint_y: None
                    height: dp(50)
                    spacing: dp(10)

                    Button:
                        text: "Сохранить как шаблон"
                        background_normal: ""
                        background_color: 0, 0, 0, 0
                        color: 0.3, 0.3, 0.3, 1
                        font_size: "14sp"
                        on_release: root.save_as_template()
                        canvas.before:
                            Color:
                                rgba: 0.95, 0.95, 0.95, 1
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [dp(10)]

                    Button:
                        text: "Назад"
                        background_normal: ""
                        background_color: 0, 0, 0, 0
                        color: 0.3, 0.3, 0.3, 1
                        font_size: "14sp"
                        on_release: root.back_to_menu()
                        canvas.before:
                            Color:
                                rgba: 0.95, 0.95, 0.95, 1
                            RoundedRectangle:
                                pos: self.pos
                                size: self.size
                                radius: [dp(10)]

                # Статус
                Label:
                    id: status_label
                    text: ""
                    markup: True
                    size_hint_y: None
                    height: dp(30)
                    font_size: "13sp"
                    color: 0.4, 0.4, 0.4, 1

                # Нижний отступ
                Widget:
                    size_hint_y: None
                    height: dp(20)